# Block Crawler 项目规则

## 版本管理规则

### Changesets 版本控制

本项目使用 [Changesets](https://github.com/changesets/changesets) 进行版本管理。

**重要约定：**
- ⚠️ **版本始终保持 0.x.x** - major 版本号始终为 0，表示项目仍在开发中
- 🔄 **只使用 minor 和 patch 版本** - 直到项目完全稳定才会手动升级到 1.0.0
- 📝 **每次代码修改都必须创建 changeset** - 使用 `pnpm changeset` 命令

### 版本更新指南

#### 1. 创建 Changeset

当你完成代码修改后，**始终**执行以下命令：

```bash
pnpm changeset
```

然后按照提示：
1. **选择版本类型**（重要！）：
   - 选择 `minor` - 用于新功能、重大改进、Breaking Changes
   - 选择 `patch` - 用于 bug 修复、小改进、文档更新
   - ❌ **永远不要选择 `major`** - 我们保持 major 版本为 0

2. **编写变更说明**：
   - 用简体中文编写
   - 使用清晰的描述和表情符号
   - 对于 Breaking Changes，在说明前加 `BREAKING CHANGE:`

#### 2. Changeset 文件示例

**Minor 版本（新功能）：**
```markdown
---
"block-crawler": minor
---

新增 getAllTabSections 配置选项

- ✨ 支持跳过 tab 点击直接获取所有 sections
- ✨ 新增 extractTabTextFromSection 配置
- 📝 自动从 section 的 heading 中提取 tab 文本
```

**Patch 版本（Bug 修复）：**
```markdown
---
"block-crawler": patch
---

修复链接收集时的空值处理

- 🐛 修复 collectionNameLocator 返回 null 时的错误
- 🐛 改进错误提示信息
```

**Breaking Changes（仍然使用 minor）：**
```markdown
---
"block-crawler": minor
---

重构目录结构

BREAKING CHANGE: 重大变更

- 🔄 将 configDir 重命名为 stateDir
- 📁 简化目录结构为域名子目录
- ❌ 移除配置文件功能
```

#### 3. 提交 Changeset

创建 changeset 后，将 `.changeset/*.md` 文件与代码一起提交：

```bash
git add .changeset/*.md
git commit -m "feat: 你的功能描述"
```

#### 4. 发布新版本（手动操作）

当准备发布时，执行：

```bash
# 1. 更新版本号并生成 CHANGELOG
pnpm changeset version

# 2. 提交版本更新
git add .
git commit -m "chore: release"

# 3. 构建并发布到 npm
pnpm release
```

### Git 提交规范

使用语义化提交信息：

- `feat:` - 新功能
- `fix:` - Bug 修复
- `refactor:` - 重构
- `docs:` - 文档更新
- `test:` - 测试相关
- `chore:` - 构建/工具链相关
- `perf:` - 性能优化

**示例：**
```bash
git commit -m "feat: 新增 getAllTabSections 配置选项"
git commit -m "fix: 修复链接收集时的空值处理"
git commit -m "refactor: 简化目录结构"
```

## 代码规范

### TypeScript

- 使用严格的 TypeScript 类型检查
- 导出的 API 必须有完整的 JSDoc 注释
- 优先使用 `interface` 而非 `type`

### 模块化

- 遵循单一职责原则
- 每个模块不超过 200 行代码
- 将大型模块拆分为多个小模块

### 测试

- 使用 Playwright 进行端到端测试
- 测试文件命名：`*.spec.ts`
- 测试用例使用中文描述

## 依赖管理

### 包管理器

- ✅ 使用 `pnpm` 作为包管理器
- ❌ 不要使用 `npm` 或 `yarn`

### 依赖更新

使用 [taze](https://github.com/antfu-collective/taze) 更新依赖：

```bash
# 更新到最新的 major 版本
pnpm dlx taze major -w

# 安装更新的依赖
pnpm install
```

## 文档规范

### README.md

- 保持简洁清晰
- 使用表情符号增强可读性
- 提供完整的使用示例
- 使用中文编写

### CHANGELOG.md

- 由 changesets 自动生成
- 不要手动编辑

### 代码注释

- 公共 API 必须有 JSDoc 注释
- 复杂逻辑添加行内注释
- 注释使用中文

## 发布规范

### npm 包发布

1. 确保所有测试通过：`pnpm test`
2. 确保构建成功：`pnpm build`
3. 运行 `pnpm changeset version` 更新版本
4. 运行 `pnpm release` 发布到 npm

### 版本号约定

- **0.x.y** - 开发版本（当前阶段）
  - `x` (minor) - 新功能、重大改进、Breaking Changes
  - `y` (patch) - Bug 修复、小改进、文档更新
- **1.0.0** - 正式版本（手动发布，表示项目完全稳定）

## AI 助手行为规范

当使用 AI 助手（如 Cursor）时：

### 代码修改后的操作流程

1. **完成代码修改** - 实现功能或修复 bug
2. **创建 changeset** - 运行 `pnpm changeset`
3. **选择正确的版本类型**：
   - 新功能/Breaking Changes → `minor`
   - Bug 修复/小改进 → `patch`
   - ❌ 永远不要选择 `major`
4. **编写变更说明** - 使用中文和表情符号
5. **提交代码** - 将代码和 changeset 一起提交

### 示例对话

**用户：** "添加一个新功能：支持自定义超时配置"

**AI 应该：**
1. 实现功能
2. 更新文档
3. 运行 `pnpm changeset` 并选择 `minor`
4. 编写 changeset 说明
5. 提交代码和 changeset

**Changeset 内容：**
```markdown
---
"block-crawler": minor
---

新增自定义超时配置

- ✨ 新增 `timeout` 配置选项
- 📝 支持为不同页面设置不同的超时时间
- 📖 更新文档和示例
```

## 重要提醒

🚨 **永远记住：**
- ✅ 版本号格式：0.x.x
- ✅ 使用 pnpm
- ✅ 每次修改都创建 changeset
- ✅ 使用中文编写文档和注释
- ❌ 不要选择 major 版本
- ❌ 不要手动编辑 CHANGELOG.md

